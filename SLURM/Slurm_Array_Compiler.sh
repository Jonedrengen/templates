#!/bin/sh
#SBATCH --time 30:00
#SBATCH -p nano
#SBATCH -o Slurm_Array_Compiler_%j.out
#SBATCH -e Slurm_Array_Compiler_%j.err

# Created by Edward Sung (edward.sung@gwu.edu) on 2/25/2024


STARTTIMER="$(date +%s)"


# Conda Enviroment - Please change to load your conda environment
# . /GWSPH/groups/liu_price_lab/tools/anaconda3/etc/profile.d/conda.sh
# conda activate your_enviroment


# Modules - Please add any modules required
# module load (module)


# Script and Tool Locations - Include any additional script path as needed
Slurm_Array_scripts="/scratch/liu_price_lab/ehsung/github/Development/ehsung/microbiome/00_TemplateScripts/scripts/slurm_array/"


# Inputs
main_output_folder_input=$1


mkdir $main_output_folder_input/compiled_files


# Create a file to store youre results -- this is just an example of a method to compile results
touch $main_output_folder_input/compiled_files/results_compiled.txt


# Create a list of your output folders
ls $main_output_folder_input/processing_files > tmplist_output_folders


# Loop through your output folders to compile your results
while read -r line
do
   echo "Extracting results from: $line"
   cat $main_output_folder_input/processing_files/${line}/results.txt >> $main_output_folder_input/compiled_files/results_compiled.txt
done < tmplist_output_folders


# Clean-up file system
rm tmplist_output_folders
mkdir $main_output_folder_input/compiled_files/slurm_files
mv Slurm_Array_Compiler_${SLURM_JOB_ID}.out $main_output_folder_input/compiled_files/slurm_files
mv Slurm_Array_Compiler_${SLURM_JOB_ID}.err $main_output_folder_input/compiled_files/slurm_files


# Script Timer
ENDTIMER="$(date +%s)"
DURATION=$[${ENDTIMER} - ${STARTTIMER}]
HOURS=$((${DURATION} / 3600))
MINUTES=$(((${DURATION} % 3600)/ 60))
SECONDS=$(((${DURATION} % 3600) % 60))

echo "RUNTIMER: $HOURS:$MINUTES:$SECONDS (hh:mm:ss)"
